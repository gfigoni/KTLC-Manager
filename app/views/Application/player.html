#{extends 'main.html' /}
#{set title:messages.get('title.player', player?.name) /}
#{set page:'player' /}

#{if player}

#{set 'moreScripts'}
    <script type="text/javascript">
        #{if player.isMapper()}
     	// the chart
        var chartEnviro;
     	
        var chartEnviroData = [
   			#{list items:stats.chart_numberMapsByEnviro.keySet(), as:'enviro'}
   				{ enviro: "${enviro.capFirst()}", maps: ${stats.chart_numberMapsByEnviro.get(enviro)} },
   			#{/list}
   		];
        function compareEnviro(a,b) {
       	  if (a.maps > b.maps)
       	     return -1;
       	  if (a.maps < b.maps)
       	    return 1;
       	  return 0;
       	}
    	chartEnviroData.sort(compareEnviro);
        #{/if}
        
        #{if player.isPlayer()}
     	// the charts
		var chartRanksByKTLCs;
	    var chartRanksByRaces;
	    var chartKTLC;
	    var chartAvgRankByEnviro;
	    var chartNumberPodiumsByEnviro;
        
        var chartRanksByKTLCsData = [
			#{list items:0..(stats.chart_ranksByKTLCs.length - 1), as:'i'}
			{ rank: "${i+1}", number: ${stats.chart_ranksByKTLCs[i]}, ratio: ${(stats.chart_ranksByKTLCs[i] / (double)stats.playedKTLCs.value)*100.0} },
			#{/list}                   
        ];
        
        var chartRanksByRacesData = [
			#{list items:0..(stats.chart_ranksByRaces.length - 1), as:'i'}
			{ rank: "${i+1}", number: ${stats.chart_ranksByRaces[i]}, ratio: ${(stats.chart_ranksByRaces[i] / (double)stats.numberPlayedRaces)*100.0} },
			#{/list}                   
        ];
        
        var chartNumberPodiumsByEnviroData = [
			#{list items:stats.chart_numberPodiumsByEnviro.keySet(), as:'enviro'}
				{ 
				  enviro: "${enviro.capFirst()}", 
				  rank_1st: ${stats.chart_numberPodiumsByEnviro.get(enviro)[0]},
				  rank_2nd: ${stats.chart_numberPodiumsByEnviro.get(enviro)[1]},
				  rank_3rd: ${stats.chart_numberPodiumsByEnviro.get(enviro)[2]},
				  total: ${stats.chart_numberPodiumsByEnviro.get(enviro)[3]},
				  numberMaps: ${stats.chart_averageRankByEnviro.get(enviro)[1]}
				},
			#{/list}  
		];
        function comparePodiumsEnviro(a,b) {
         	  if (a.rank_1st > b.rank_1st)
         	     return -1;
         	  if (a.rank_1st < b.rank_1st)
         	    return 1;
         	  if (a.rank_1st == b.rank_1st) {
         		  if (a.rank_2nd > b.rank_2nd)
             	     return -1;
             	  if (a.rank_2nd < b.rank_2nd)
             	     return 1;
             	  if (a.rank_2nd == b.rank_2nd) {
             		 if (a.rank_3rd > b.rank_3rd)
                	     return -1;
                	  if (a.rank_3rd < b.rank_3rd)
                	     return 1;
                	  else
                		 return 0;
             	 }
         	  }
        }
        chartNumberPodiumsByEnviroData.sort(comparePodiumsEnviro);
        
        var chartAvgRankByEnviroData = [
 			#{list items:stats.chart_averageRankByEnviro.keySet(), as:'enviro'}
 				{ 
 				  enviro: "${enviro.capFirst()}", 
 				  avg: ${stats.chart_averageRankByEnviro.get(enviro)[0]},
 				  cleanValue: ${stats.chart_averageRankByEnviro.get(enviro)[0]}.toFixed(2),
 				  numberMaps: ${(int)stats.chart_averageRankByEnviro.get(enviro)[1]}
 				},
 			#{/list}  
 		];
        function compareAvgRankEnviro(a,b) {
        	var avgA = a.avg, avgB = b.avg;
        	if (avgA != 0 && avgB != 0) {
	       	  if (avgA > avgB)
	       	     return 1;
	       	  if (avgA < avgB)
	       	    return -1;
	       	  return 0;
        	}
        	if (avgA != 0 && avgB == 0) {
        		return -1;
        	}
        	if (avgA == 0 && avgB != 0) {
        		return 1;
        	}
        	return 0;
       	}
        chartAvgRankByEnviroData.sort(compareAvgRankEnviro);
        
        var chartDataKTLC = [
  	        #{list items:ktlcs, as:'ktlc'}
  	        { ktlc: "${ktlc.number}", ratio: ${ktlc.getRatio(player)}, rank: ${ktlc.getResult(player) ? ktlc.getResult(player).rank : 0}, total: ${ktlc.results.size()} }${ktlc_isLast ? '' : ','}
  	        #{/list}
  	    ];
        #{/if}
        
        AmCharts.ready(function () {           
            #{if player.isMapper()}
         	// CHART Maps/Enviro  ------------------------------------------------------------------
         	chartEnviro = new AmCharts.AmSerialChart();
            
        	chartEnviro.dataProvider = chartEnviroData;
        	chartEnviro.categoryField = "enviro";
        	chartEnviro.rotate= true;
        	chartEnviro.color = "#FEFADC";
        	chartEnviro.columnWidth = 0.5;
        	chartEnviro.marginTop = 0;
            chartEnviro.marginBottom = 0;
			
			// Graph
	        var graphEnviro = new AmCharts.AmGraph();
	        graphEnviro.balloonText = "[[value]] maps";
	        graphEnviro.valueField = "maps";
	        graphEnviro.type = "column";
	        graphEnviro.lineAlpha = 0;
	        graphEnviro.fillAlphas = 1;
	        graphEnviro.fillColors = "#C37700";
	        
	        chartEnviro.addGraph(graphEnviro);
	        
	     	// Axes
	     	// category
            var categoryEnviroAxis = chartEnviro.categoryAxis;
            categoryEnviroAxis.gridPosition = "start";
            // value                
            var valueEnviroAxis = new AmCharts.ValueAxis();
            valueEnviroAxis.minimum = 0;
            valueEnviroAxis.integersOnly = true;
            chartEnviro.addValueAxis(valueEnviroAxis);
            
         	// Cursor
            var chartEnviroCursor = new AmCharts.ChartCursor();
            chartEnviroCursor.cursorPosition = "middle";
            chartEnviroCursor.categoryBalloonEnabled = false;
            chartEnviro.addChartCursor(chartEnviroCursor);
	
            chartEnviro.write('chartContainerEnviro');         	
         	#{/if}
         	
       		#{if player.isPlayer()}            
           	// CHART Ranks by KTLCs  ------------------------------------------------------------------
           	chartRanksByKTLCs = new AmCharts.AmSerialChart();
               
           	chartRanksByKTLCs.dataProvider = chartRanksByKTLCsData;
           	chartRanksByKTLCs.categoryField = "rank";
           	chartRanksByKTLCs.rotate= true;
           	chartRanksByKTLCs.color = "#FEFADC";
           	chartRanksByKTLCs.columnWidth = 0.5;
           	chartRanksByKTLCs.marginTop = 0;
           	chartRanksByKTLCs.marginBottom = 0;
   			
   			// Graph
   	        var graphRanksByKTLCs = new AmCharts.AmGraph();
   	     	graphRanksByKTLCs.balloonText = "([[category]].) [[value]] KTLCs";
   	     	graphRanksByKTLCs.valueField = "number";
	   	  	graphRanksByKTLCs.type = "column";
		   	graphRanksByKTLCs.lineAlpha = 0;
		   	graphRanksByKTLCs.fillAlphas = 1;
		   	graphRanksByKTLCs.fillColors = "#C37700";
   	        
		   	chartRanksByKTLCs.addGraph(graphRanksByKTLCs);
   	        
   	     	// Axes
   	     	// category
            var catRanksByKTLCsAxis = chartRanksByKTLCs.categoryAxis;
            catRanksByKTLCsAxis.title = "&{'player.stats.Rank'}";
            // value                
            var valueRanksByKTLCsAxis = new AmCharts.ValueAxis();
            valueRanksByKTLCsAxis.minimum = 0;
            valueRanksByKTLCsAxis.integersOnly = true;
            chartRanksByKTLCs.addValueAxis(valueRanksByKTLCsAxis);
            
         	// Cursor
            var chartRanksByKTLCsCursor = new AmCharts.ChartCursor();
            chartRanksByKTLCsCursor.cursorPosition = "middle";
            chartRanksByKTLCsCursor.categoryBalloonEnabled = false;
            chartRanksByKTLCs.addChartCursor(chartRanksByKTLCsCursor);
	
            chartRanksByKTLCs.write('chartContainerRanksKTLCs');
            
         	// CHART Ranks by Races  ------------------------------------------------------------------
           	chartRanksByRaces = new AmCharts.AmSerialChart();
               
           	chartRanksByRaces.dataProvider = chartRanksByRacesData;
           	chartRanksByRaces.categoryField = "rank";
           	chartRanksByRaces.rotate= true;
           	chartRanksByRaces.color = "#FEFADC";
           	chartRanksByRaces.columnWidth = 0.5;
           	chartRanksByRaces.marginTop = 0;
           	chartRanksByRaces.marginBottom = 0;
   			
   			// Graph
   	        var graphRanksByRaces = new AmCharts.AmGraph();
   	     	graphRanksByRaces.balloonText = "([[category]].) [[value]] &{'player.nbraces'}";
   	     	graphRanksByRaces.valueField = "number";
	   	  	graphRanksByRaces.type = "column";
		   	graphRanksByRaces.lineAlpha = 0;
		   	graphRanksByRaces.fillAlphas = 1;
		   	graphRanksByRaces.fillColors = "#C37700";
   	        
		   	chartRanksByRaces.addGraph(graphRanksByRaces);
   	        
   	     	// Axes
   	     	// category
            var catRanksByRacesAxis = chartRanksByRaces.categoryAxis;
            catRanksByRacesAxis.title = "&{'player.stats.Rank'}";
            // value                
            var valueRanksByRacesAxis = new AmCharts.ValueAxis();
            valueRanksByRacesAxis.minimum = 0;
            valueRanksByRacesAxis.integersOnly = true;
            chartRanksByRaces.addValueAxis(valueRanksByRacesAxis);
            
         	// Cursor
            var chartRanksByRacesCursor = new AmCharts.ChartCursor();
            chartRanksByRacesCursor.cursorPosition = "middle";
            chartRanksByRacesCursor.categoryBalloonEnabled = false;
            chartRanksByRaces.addChartCursor(chartRanksByRacesCursor);
	
            chartRanksByRaces.write('chartContainerRanksRaces');
            
         	// CHART KTLCs -------------------------------------------------------------------
            chartKTLC = new AmCharts.AmSerialChart();
            
            chartKTLC.pathToImages = "@{'/public/images/amcharts/'}/";
            chartKTLC.panEventsEnabled = true;
            chartKTLC.dataProvider = chartDataKTLC;
            chartKTLC.categoryField = "ktlc";
            chartKTLC.marginTop = 0;
            chartKTLC.marginLeft = 0;
            chartKTLC.marginRight = 0;
            chartKTLC.marginBottom = 0;
            chartKTLC.color = "#FEFADC";
            chartKTLC.zoomOutButton = {
                 backgroundColor: "#C37700",
                 backgroundAlpha: 0.5
            };

            // listen for "dataUpdated" event (fired when chart is rendered) and call zoomChart method when it happens
            chartKTLC.addListener("dataUpdated", zoomChart);

            // Axes
            // category
            var catKTLCAxis = chartKTLC.categoryAxis;
            catKTLCAxis.gridCount = chartDataKTLC.length;
            catKTLCAxis.labelRotation = 90;
            // value                
            var valueKTLCAxis = new AmCharts.ValueAxis();
            valueKTLCAxis.minimum = 0;
            valueKTLCAxis.maximum = 100;
            chartKTLC.addValueAxis(valueKTLCAxis);

            // Graph
            var graphKTLC = new AmCharts.AmGraph();
            graphKTLC.balloonText = "ktlc #[[category]] - [[rank]]/[[total]]";
            graphKTLC.valueField = "ratio"
            graphKTLC.type = "column";
            graphKTLC.lineAlpha = 0;
            graphKTLC.fillAlphas = 1;
            graphKTLC.fillColors = "#C37700"
            chartKTLC.addGraph(graphKTLC);

            // Cursor
            var chartKTLCCursor = new AmCharts.ChartCursor();
            chartKTLCCursor.cursorPosition = "middle";
            chartKTLCCursor.categoryBalloonEnabled = false;
            chartKTLCCursor.pan = true;
            chartKTLC.addChartCursor(chartKTLCCursor);

            // scrollbar
            var chartKTLCScrollbar = new AmCharts.ChartScrollbar();
            chartKTLCScrollbar.graph = graphKTLC;
            chartKTLCScrollbar.scrollbarHeight = 35;
            chartKTLCScrollbar.autoGridCount = false;
            chartKTLCScrollbar.hideResizeGrips = true;
            chartKTLCScrollbar.backgroundAlpha = 0;
            chartKTLCScrollbar.selectedBackgroundColor = "#C37700";
            chartKTLCScrollbar.selectedBackgroundAlpha = 0.5;
            chartKTLCScrollbar.graphFillColor = "#444444";
            chartKTLCScrollbar.graphFillAlpha = 1;
            chartKTLC.addChartScrollbar(chartKTLCScrollbar);

            chartKTLC.write('chartContainerKTLC');
            
         	// CHART avg rank by enviro  ------------------------------------------------------------------
           	chartAvgRankByEnviro = new AmCharts.AmSerialChart();
               
           	chartAvgRankByEnviro.dataProvider = chartAvgRankByEnviroData;
           	chartAvgRankByEnviro.categoryField = "enviro";
           	chartAvgRankByEnviro.rotate= true;
           	chartAvgRankByEnviro.color = "#FEFADC";
           	chartAvgRankByEnviro.columnWidth = 0.5;
           	chartAvgRankByEnviro.marginTop = 0;
           	chartAvgRankByEnviro.marginBottom = 0;
   			
   			// Graph
   	        var graphAvgRankByEnviro = new AmCharts.AmGraph();
   	     	graphAvgRankByEnviro.balloonText = "[[cleanValue]] ([[numberMaps]] maps)";
   	     	graphAvgRankByEnviro.valueField = "avg";
	   	  	graphAvgRankByEnviro.type = "column";
		   	graphAvgRankByEnviro.lineAlpha = 0;
		   	graphAvgRankByEnviro.fillAlphas = 1;
		   	graphAvgRankByEnviro.fillColors = "#C37700";
   	        
		   	chartAvgRankByEnviro.addGraph(graphAvgRankByEnviro);
   	        
   	     	// Axes
   	     	// category
            var categoryAvgRankByEnviroAxis = chartAvgRankByEnviro.categoryAxis;
            categoryAvgRankByEnviroAxis.gridPosition = "start";
            // value                
            var valueAvgRankByEnviroAxis = new AmCharts.ValueAxis();
            valueAvgRankByEnviroAxis.minimum = 0.0;
            chartAvgRankByEnviro.addValueAxis(valueAvgRankByEnviroAxis);
            
         	// Cursor
            var chartAvgRankByEnviroCursor = new AmCharts.ChartCursor();
            chartAvgRankByEnviroCursor.cursorPosition = "middle";
            chartAvgRankByEnviroCursor.categoryBalloonEnabled = false;
            chartAvgRankByEnviro.addChartCursor(chartAvgRankByEnviroCursor);
	
            chartAvgRankByEnviro.write('chartContainerAvgRankByEnviro');
            
         	// CHART podiums by enviro  ------------------------------------------------------------------
           	chartPodiumsByEnviro = new AmCharts.AmSerialChart();
           	chartPodiumsByEnviro.dataProvider = chartNumberPodiumsByEnviroData;
           	chartPodiumsByEnviro.categoryField = "enviro";
           	chartPodiumsByEnviro.rotate= true;
           	chartPodiumsByEnviro.color = "#FEFADC";
           	chartPodiumsByEnviro.columnWidth = 0.5;
           	chartPodiumsByEnviro.marginTop = 0;
           	chartPodiumsByEnviro.marginBottom = 0;

            // AXES
            // category
            var categoryPodiumsByEnviroAxis = chartPodiumsByEnviro.categoryAxis;
            categoryPodiumsByEnviroAxis.gridPosition = "start";
            // value
            var valuePodiumsByEnviroAxis = new AmCharts.ValueAxis();
            valuePodiumsByEnviroAxis.stackType = "regular";
            valuePodiumsByEnviroAxis.integersOnly = true;
            chartPodiumsByEnviro.addValueAxis(valuePodiumsByEnviroAxis);

            // GRAPHS
            // first graph    
            var graph = new AmCharts.AmGraph();
            graph.title = "&{'player.stats.first'}";
            graph.labelText = "[[value]]";
            graph.balloonText = "(&{'player.stats.first_short'}) [[enviro]]: [[value]] / [[numberMaps]]";
            graph.valueField = "rank_1st";
            graph.type = "column";
            graph.lineAlpha = 0;
            graph.fillAlphas = 1;
            //graph.lineColor = "#C98910"; // gold
            graph.fillColors = ["#e39a12", "#9c690c"];
            graph.gradientOrientation = "horizontal";
            chartPodiumsByEnviro.addGraph(graph);

            // second graph              
            graph = new AmCharts.AmGraph();
            graph.title = "&{'player.stats.second'}";
            graph.labelText = "[[value]]";
            graph.balloonText = "(&{'player.stats.second_short'}) [[enviro]]: [[value]] / [[numberMaps]]";
            graph.valueField = "rank_2nd";
            graph.type = "column";
            graph.lineAlpha = 0;
            graph.fillAlphas = 1;
            //graph.lineColor = "#A8A8A8"; // silver
            graph.fillColors = ["#c2c2c2", "#7d7d7d"];
            graph.gradientOrientation = "horizontal";
            chartPodiumsByEnviro.addGraph(graph);

            // third graph                              
            graph = new AmCharts.AmGraph();
            graph.title = "&{'player.stats.third'}";
            graph.labelText = "[[value]]";
            graph.balloonText = "(&{'player.stats.third_short'}) [[enviro]]: [[value]] / [[numberMaps]]";
            graph.valueField = "rank_3rd";
            graph.type = "column";
            graph.lineAlpha = 0;
            graph.fillAlphas = 1;
            //graph.lineColor = "#965A38"; // bronze
            graph.fillColors = ["#c9794b", "#6e4129"];
            graph.gradientOrientation = "horizontal";
            chartPodiumsByEnviro.addGraph(graph);

            // LEGEND                  
            var legend = new AmCharts.AmLegend();
            legend.color = "#FEFADC";
            legend.autoMargins = false;
            legend.horizontalGap = 0;
            legend.valueWidth = 11;
            legend.spacing = 0;
            legend.align = "center";
            chartPodiumsByEnviro.addLegend(legend);

            chartPodiumsByEnviro.write('chartContainerPodiumsByEnviro');
         	#{/if}
        });
        
        function zoomChart() {
            chartKTLC.zoomToIndexes(chartDataKTLC.length - 15, chartDataKTLC.length - 1);
        }
    </script>
#{/set}

<div id="content_top">
    <ul>
        <li><h1><a>${player.name}</a></h1></li>
    </ul>
</div>
<div id="main">
    <div id="content">        
        #{if player.isPlayer()}
        <!-- WIDE PART 0 PLAYER --------------------------------------------------------------------- -->
        <div id="chartContainerKTLC" style="width: 850px; height: 400px;"></div>
        
        <div class="content_generalStats">
    		<div class="statsSpace"><hr></div>
    	
        	<!-- LEFT PART 1 PLAYER --------------------------------------------------------------------- -->
	        <div class="content_chartLeft">
		        <div class="player_box">
		        	<div class="ranking_title">
		                <h2>&{'player.stats.ktlcEd'}</h2>
		            </div>
		       		#{paginate.controls items:results /}
		            <table>
		                <tr>
		                    <th>&{'ktlc.number.title'}</th>
		                    <th>&{'player.rank'}</th>
		                    <th>&{'player.score'}</th>
		                    <th>&{'player.nbraces'}</th>
		                </tr>
		                #{paginate.list items:results, as:'result'}
		                <tr>
		                    <td>#{a @Application.ktlc(result.ktlc.number)}&{'ktlc.number', result.ktlc.number}#{/a}</td>
		                    <td>${result.rank} / ${result.ktlc.results.size()}</td>
		                    <td>${result.score}</td>
		                    <td>${result.nbRaces}</td>
		                </tr>
		                #{/paginate.list}
		            </table>
		            #{paginate.summary items:results /}
		        </div>
	        </div>
	        
	        <!-- RIGHT PART 1 PLAYER --------------------------------------------------------------------- -->
	        <div class="content_chartRight">
	        	<div class="ranking_title">
	                <h2>&{'player.stats.playerStats'}</h2>
	                <p>&{'player.stats.playerStats_legend'}</p>
	            </div>
	            <div class="player_stats">
		    		<table>
		    			<tr class="subtitle">
		    				<td>&{'player.stats.participation'}</td>
		    				<td></td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numKTLC'}</td>
		    				<td>${stats.playedKTLCs.value} / ${stats.playedKTLCs.total}</td>
		    				<td>${(stats.playedKTLCs.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td class="details">&{'player.stats.numKTLC_TMU'}</td>
		    				<td>${stats.playedKTLC_TMU.value} / ${stats.playedKTLC_TMU.total}</td>
		    				<td>${(stats.playedKTLC_TMU.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td class="details">&{'player.stats.numSKTLC_TMU'}</td>
		    				<td>${stats.playedSuperKTLC_TMU.value} / ${stats.playedSuperKTLC_TMU.total}</td>
		    				<td>${(stats.playedSuperKTLC_TMU.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td class="details">&{'player.stats.numKTLC_TM2'}</td>
		    				<td>${stats.playedKTLC_TM2.value} / ${stats.playedKTLC_TM2.total}</td>
		    				<td>${(stats.playedKTLC_TM2.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numRaces'}</td>
		    				<td>${stats.numberPlayedRaces}</td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numRuns'}</td>
		    				<td>${stats.numberPlayedRuns}</td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.avgRankKTLC'}</td>
		    				<td>${stats.averageRank.format('0.00')}</td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.avgOpponents'}</td>
		    				<td>${stats.averageNumberOpponents.format('0.00')}</td>
		    				<td></td>
		    			</tr>
		    			<tr class="subtitle">
		    				<td>&{'player.stats.bestEnviro'}</td>
		    				<td></td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.bestAvgRank'}</td>
		    				<td>
		    					#{list items:stats.bestEnviroFromAvgRank, as:'enviro'}
		                        ${enviro.capFirst()}
		                        #{if !enviro_isLast}<br/>#{/if}
		                        #{/list}
		    				</td>
		    				<td>${(stats.chart_averageRankByEnviro.get(stats.bestEnviroFromAvgRank.get(0))[0]).format('0.00')}</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.higestNumPodium'}</td>
		    				#{if stats.bestEviroFromPodiums != null}
		    				<td>
		    					#{list items:stats.bestEviroFromPodiums, as:'enviro'}
		                        ${enviro.capFirst()}
		                        #{if !enviro_isLast}<br/>#{/if}
		                        #{/list}
		    				</td>
		    				<td>${stats.chart_numberPodiumsByEnviro.get(stats.bestEviroFromPodiums.get(0))[3]} Podiums</td>
		    				#{/if}#{else}
		    				<td>&{'player.stats.noPodium'}</td>
		    				<td></td>
		    				#{/else}
		    			</tr>
		    			<tr class="subtitle">
		    				<td>&{'player.stats.podiums'}</td>
		    				<td></td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.byKTLCs'}</td>
		    				<td>${stats.numberPodiumsKTLC.value} / ${stats.numberPodiumsKTLC.total}</td>
		    				<td>${(stats.numberPodiumsKTLC.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.byRaces'}</td>
		    				<td>${stats.numberPodiumsRace.value} / ${stats.numberPodiumsRace.total}</td>
		    				<td>${(stats.numberPodiumsRace.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numPerfects'}</td>
		    				<td>
		    					#{if stats.perfects.size() > 0}
		    						${stats.perfects.size()} / ${stats.playedKTLCs.value}
		    					#{/if}#{else}
		    						${stats.perfects.size()}
		    					#{/else}
							</td>
		    				<td>
		    					#{if stats.perfects.size() > 0}
			    					#{list items:0..stats.perfects.size() - 1, as:'i'}
		                        	#{if (stats.perfects.size() > 1 && i > 0)}<br />#{/if}
		                        	#{a @Application.ktlc(stats.perfects.get(i).number)}&{'ktlc.number', stats.perfects.get(i).number} (${stats.perfects.get(i).date.format()})#{/a}
		                        	#{/list}
	                        	#{/if}
	                      	</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.longSeriePodium'}</td>
		    				<td>${stats.longestPodiumSerie.size()}</td>
		    				<td>
		    					#{if stats.longestPodiumSerie.size() == 1}
		    						#{a @Application.ktlc(stats.longestPodiumSerie.get(0).number)}&{'ktlc.number', stats.longestPodiumSerie.get(0).number} (${stats.longestPodiumSerie.get(0).date.format()})#{/a}
		    					#{/if}
		    					#{elseif stats.longestPodiumSerie.size() > 1}
		    						&{'player.stats.from'} #{a @Application.ktlc(stats.longestPodiumSerie.get(stats.longestPodiumSerie.size()-1).number)}&{'ktlc.number', stats.longestPodiumSerie.get(stats.longestPodiumSerie.size()-1).number} (${stats.longestPodiumSerie.get(stats.longestPodiumSerie.size()-1).date.format()})#{/a}<br/>
		    						&{'player.stats.to'} #{a @Application.ktlc(stats.longestPodiumSerie.get(0).number)}&{'ktlc.number', stats.longestPodiumSerie.get(0).number} (${stats.longestPodiumSerie.get(0).date.format()})#{/a}
		    					#{/elseif}
	    					</td>
		    			</tr>
		    			<tr class = subtitle>
		    				<td>&{'player.stats.lastPlaces'}</td>
		    				<td></td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.byKTLCs'}</td>
		    				<td>${stats.numberLastPlaceKTLC.value} / ${stats.numberLastPlaceKTLC.total}</td>
		    				<td>${(stats.numberLastPlaceKTLC.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.byRaces'}</td>
		    				<td>${stats.numberLastPlaceRace.value} / ${stats.numberLastPlaceRace.total}</td>
		    				<td>${(stats.numberLastPlaceRace.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numEpicFails'}</td>
		    				<td>
		    					#{if stats.epicFails.size() > 0}
		    						${stats.epicFails.size()} / ${stats.playedKTLCs.value}
		    					#{/if}#{else}
		    						${stats.epicFails.size()}
		    					#{/else}
							</td>
		    				<td>
		    					#{if stats.epicFails.size() > 0}
			    					#{list items:0..stats.epicFails.size() - 1, as:'i'}
		                        	#{if (stats.epicFails.size() > 1 && i > 0)}<br />#{/if}
		                        	#{a @Application.ktlc(stats.epicFails.get(i).number)}&{'ktlc.number', stats.epicFails.get(i).number} 
		   							(${stats.epicFails.get(i).date.format()})#{/a}
		                        	#{/list}
	                        	#{/if}
	                      	</td>
		    			</tr>
		    		</table>
	    		</div>
	        </div>
        </div>
        
        <div class="cleaner"></div>
        <div class="statsSpace"></div>
	    
	    <div class="content_generalStats">
	    	<!-- LEFT PART 2 PLAYER --------------------------------------------------------------------- -->
	    	<div class="content_chartLeft">
		    	<h1>&{'player.stats.ktlcResultsbyRank'}</h1>
		    	<div id="chartContainerRanksKTLCs" style="width: 420px; height: 500px;"></div>
	    	</div>
	    	<!-- RIGHT PART 2 PLAYER --------------------------------------------------------------------- -->
	        <div class="content_chartRight">
		        <h1>&{'player.stats.raceResultsbyRank'}</h1>
		        <div id="chartContainerRanksRaces" style="width: 420px; height: 500px;"></div>
	        </div>
	     </div>
	     
	    <div class="cleaner"></div>
	    <div class="statsSpace"></div>
	    
	    <div class="content_generalStats">
	    	<!-- LEFT PART 3 PLAYER --------------------------------------------------------------------- -->
	    	<div class="content_chartLeft">
		    	<h1>&{'player.stats.avgRankByEnviro'}</h1>
		    	<div id="chartContainerAvgRankByEnviro" style="width: 420px; height: 360px;"></div>
	    	</div>
	    	<!-- RIGHT PART 3 PLAYER --------------------------------------------------------------------- -->
	        <div class="content_chartRight">
		        <h1>&{'player.stats.numPodiumsByEnviro'}</h1>
		        <div id="chartContainerPodiumsByEnviro" style="width: 420px; height: 400px;"></div>
	        </div>
	     </div>
	    <div class="cleaner"></div>
	    #{/if}
	    
	    #{if player.isMapper()}
	    <div class="content_generalStats">
	    	#{if player.isPlayer()}
	    	<div class="statsSpace"><hr></div>
	    	#{/if}
	    
	    	<!-- LEFT PART 1 MAPPER  --------------------------------------------------------------------- -->
		    <div class="content_chartLeft">
		        <div class="map_box">
		        	<div class="ranking_title">
		                <h2>&{'player.stats.createdMaps'}</h2>
		            </div>
		       		#{paginate.controls items:races /}
		            <table>
		                <tr>
		                    <th>&{'player.stats.mapName'}</th>
		                    <th>&{'player.stats.enviro'}</th>
		                    <th>&{'player.stats.ktlc'}</th>
		                </tr>
		                #{paginate.list items:races, as:'race'}
		                <tr>
		                    <td style="text-align: left;">#{if race.map.name.length() > 25}${race.map.name.substring(0,25)}...#{/if}#{else}${race.map.name}#{/else}</td>
		                    <td style="text-align: left;">${race.map.environment.capFirst()}</td>
		                    <td>#{a @Application.ktlc(race.ktlc.number)}&{'ktlc.number', race.ktlc.number}#{/a}</td>
		                </tr>
		                #{/paginate.list}
		            </table>
		            #{paginate.summary items:races /}
		        </div>
	        </div>
	    
	    	<!-- RIGHT PART 1 MAPPER  --------------------------------------------------------------------- -->
	    	<div class="content_chartRight">
	    		<div class="ranking_title">
	                <h2>&{'player.stats.mapperStats'}</h2>
	                <p>&{'player.stats.mapperStats_legend'}</p>
	            </div>
		        <div class="player_stats">
		    		<table>
		    			<tr  class="subtitle">
		    				<td>&{'player.stats.stats'}</td>
		    				<td></td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numCreated'}</td>
		    				<td>${stats.createdMaps.value} / ${stats.createdMaps.total}</td>
		    				<td>${(stats.createdMaps.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numDistinctPlayer'}</td>
		    				<td>${stats.distinctPlayersOnMaps.value} / ${stats.distinctPlayersOnMaps.total}</td>
		    				<td>${(stats.distinctPlayersOnMaps.ratio*100.0).format('0.00')} %</td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.avgNumPlayer'}</td>
		    				<td>${stats.averageNumberPlayersOnMaps.format('0.00')}</td>
		    				<td></td>
		    			</tr>	    			
		    			<tr>
		    				<td>&{'player.stats.numRunsOnMaps'}</td>
		    				<td>${stats.numberRunsOnMaps}</td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.numDistinctKtlcs'}</td>
		    				<td>${stats.numberDistinctKTLCsAsMapper}</td>
		    				<td></td>
		    			</tr>
		    			<tr>
		    				<td>&{'player.stats.favEnviro'}</td>
		    				<td>
								#{list items:stats.favoriteMappingEnviros, as:'enviro'}
		                        ${enviro.capFirst()}
		                        #{if !enviro_isLast}<br/>#{/if}
		                        #{/list}
		    				</td>
		    				<td>${stats.chart_numberMapsByEnviro.get(stats.favoriteMappingEnviros.get(0))} maps</td>
		    			</tr>
		    		</table>
	    		</div>
	    		
	    		<div class="statsSpace"></div>
	    		
	    		<h1>&{'player.stats.numMapsByEnviro'}</h1>
		        <div id="chartContainerEnviro" style="width: 420px; height: 300px;"></div>
	        </div>
	        
        	<div class="cleaner"></div>
        </div>
        #{/if}
    </div>
</div>
#{/if}

#{else}
<div id="content_top">
    <ul>
        <li><h1><a>&{'error.noplayer'}</a></h1></li>
    </ul>
</div>
<div id="main">
    <div id="content">
        <div class="content_box">
            &{'error.wrongplayer'}
        </div>
    </div>
    <div class="cleaner"></div>
</div>
#{/else}